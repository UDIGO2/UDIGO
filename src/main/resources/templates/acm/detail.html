<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숙소 상세</title>
    <link rel="stylesheet" th:href="@{/css/detail.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=66ee0366c34ede131d6dce128078a011&libraries=services"></script>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>
    
    <div class="content">
        <div class="container">
            <!-- 왼쪽 섹션 - 숙소 정보 및 후기 -->
            <div class="left-section">
                <!-- 필터바 -->
                <div class="filter-bar">
                    <div class="filter-container">
                        <div class="filter-box">
                            <div class="filter-item" id="date-filter">
                                <i class="calendar-icon"></i>
                                <input type="text" th:value="${param.checkInDate != null and param.checkOutDate != null} ? ${param.checkInDate + ' ~ ' + param.checkOutDate}" placeholder="날짜를 선택해주세요." readonly>
                            </div>
                            <div class="filter-item" id="guest-filter">
                                <i class="person-icon"></i>
                                <input type="text" th:value="${param.guests != null} ? ${param.guests + '명'}" placeholder="인원 수를 선택해주세요." readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 컨텐츠 래퍼 -->
                <div class="content-wrapper">
                    <!-- 숙소 기본 정보 -->
                    <div class="accommodation-info">
                        <h1 th:text="${acm.acmName}">숙소 이름</h1>
                        <div class="price-info">
                            <div class="price-wrapper">
                                <div>
                                    <span class="price" th:text="${#numbers.formatDecimal(acm.acmPrice, 0, 'COMMA', 0, 'POINT')} + '원'">가격</span>
                                    <span class="per-night">/박</span>
                                </div>
                                <button class="payment-btn">결제하기</button>
                            </div>
                        </div>
                        <div class="location">
                            <i class="location-icon"></i>
                            <span th:text="${acm.acmAddress}">주소</span>
                        </div>

                        <!-- 이미지 갤러리 섹션 시작 -->
                        <div class="image-gallery">
                            <!-- 메인 이미지 -->
                            <div class="main-image">
                                <img th:src="@{${acm.acmPhoto1}}" th:alt="${acm.acmName}">
                            </div>
                            <!-- 추가 이미지들: 오른쪽에 세로로 나열됨 -->
                            <div class="sub-images" th:if="${acm.acmPhoto2 != null || acm.acmPhoto3 != null || acm.acmPhoto4 != null}">
                                <img th:if="${acm.acmPhoto2 != null}" th:src="@{${acm.acmPhoto2}}" alt="추가 이미지">
                                <img th:if="${acm.acmPhoto3 != null}" th:src="@{${acm.acmPhoto3}}" alt="추가 이미지">
                                <img th:if="${acm.acmPhoto4 != null}" th:src="@{${acm.acmPhoto4}}" alt="추가 이미지">
                            </div>
                        </div>
                        <!-- 이미지 갤러리 섹션 끝 -->

                        <div class="basic-info">
                            <div class="info-item">
                                <i class="person-icon"></i>
                                <span th:text="'최대 ' + ${acm.maxGuest} + '인'">최대 인원</span>
                            </div>
                            <div class="info-item">
                                <i class="phone-icon"></i>
                                <span th:text="${acm.acmPhone}">연락처</span>
                            </div>
                        </div>

                        <div class="description" th:text="${acm.acmInfo}">
                            숙소 설명
                        </div>
                    </div>

                    </div>

                    <!-- 후기 섹션 -->
                    <div class="reviews-section">
                        <h2>후기</h2>
                        <div class="reviews-list">
                            <!-- 후기 내용은 추후 추가 -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- 오른쪽 섹션 - 지도 -->
            <div class="right-section">
                <!-- 지도를 표시할 div -->
                <div class="map-section">
                    <div id="staticMap" style="width:100%;height:100%;"></div>
                </div>
            </div>

            <!-- 세로 구분선 -->
            <div class="vertical-divider"></div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
    <script th:src="@{/js/header.js}"></script>

    <!-- 필터바 스크립트 -->
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // 모달 생성 함수
            function createModal(title, content, callback) {
                document.querySelectorAll('.modal.active').forEach(modal => modal.classList.remove('active'));

                let modal = document.querySelector(`.modal[data-title="${title}"]`);

                if (!modal) {
                    modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.setAttribute('data-title', title);
                    modal.innerHTML = `
                        <div class="modal-header">${title}</div>
                        <div class="modal-content">${content}</div>
                        <div class="modal-footer">
                            <button class="modal-confirm-btn">확인</button>
                        </div>
                    `;
                    document.body.appendChild(modal);

                    modal.querySelector('.modal-confirm-btn').addEventListener('click', function() {
                        if (callback()) {
                            modal.classList.remove('active');
                        }
                    });
                }

                return modal;
            }

            
            // 날짜 선택 모달
            const dateModal = createModal('날짜 선택', `
                <div style="padding: 15px;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">체크인:</label>
                        <input type="date" id="check-in-date" style="width: 100%; padding: 8px;" min="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">체크아웃:</label>
                        <input type="date" id="check-out-date" style="width: 100%; padding: 8px;">
                    </div>
                    <div class="modal-info" style="font-size: 0.9em; color: #666;">
                        * 체크인 날짜는 오늘 이후만 선택 가능합니다.<br>
                        * 체크아웃은 체크인 다음 날부터 선택 가능합니다.
                    </div>
                </div>
            `, function() {
                const checkInDate = document.getElementById('check-in-date').value;
                const checkOutDate = document.getElementById('check-out-date').value;

                if (!checkInDate || !checkOutDate) {
                    alert('체크인과 체크아웃 날짜를 모두 선택해주세요.');
                    return false;
                }

                if (new Date(checkInDate) >= new Date(checkOutDate)) {
                    alert('체크아웃 날짜는 체크인 날짜 이후여야 합니다.');
                    return false;
                }

                document.querySelector('#date-filter input').value = `${checkInDate} ~ ${checkOutDate}`;
                return true;
            });

            // 인원 선택 모달
            const guestModal = createModal('인원 선택', `
                <div id="guest-modal-content" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <label><input type="radio" name="guest" value="1"> 1명</label>
                    <label><input type="radio" name="guest" value="2"> 2명</label>
                    <label><input type="radio" name="guest" value="3"> 3명</label>
                    <label><input type="radio" name="guest" value="4"> 4명</label>
                    <label><input type="radio" name="guest" value="5"> 5명</label>
                    <label><input type="radio" name="guest" value="6"> 6명</label>
                    <label><input type="radio" name="guest" value="7"> 7명</label>
                    <label><input type="radio" name="guest" value="8"> 8명</label>
                    <label><input type="radio" name="guest" value="9"> 9명</label>
                </div>
            `, function() {
                const selectedGuest = document.querySelector('input[name="guest"]:checked').value;
                document.querySelector('#guest-filter input').value = selectedGuest + '명';
                return true;
            });

            // 모달 열기 함수
            function openModal(modal) {
                if (!document.querySelector('.modal.active')) {
                    modal.classList.add('active');
                }
            }

            // 필터 클릭 이벤트
            document.getElementById('date-filter').addEventListener('click', () => openModal(dateModal));
            document.getElementById('guest-filter').addEventListener('click', () => openModal(guestModal));

            // 체크인 날짜 선택 시 체크아웃 최소 날짜 설정
            document.getElementById('check-in-date')?.addEventListener('change', function() {
                const checkOutInput = document.getElementById('check-out-date');
                if (this.value) {
                    const nextDay = new Date(this.value);
                    nextDay.setDate(nextDay.getDate() + 1);
                    checkOutInput.min = nextDay.toISOString().split('T')[0];

                    if (checkOutInput.value && new Date(checkOutInput.value) <= new Date(this.value)) {
                        checkOutInput.value = '';
                    }
                }
            });
        });
    </script>

    <!-- 카카오맵 API 스크립트 -->
    <sFcript type="text/javascript">
        window.addEventListener('load', function() {
            debugger;
            // 주소-좌표 변환 객체를 생성
            var geocoder = new kakao.maps.services.Geocoder();
            var address = '[[${acm.acmAddress}]]';
            var acmName = '[[${acm.acmName}]]';
            debugger;
            // 주소로 좌표를 검색
            geocoder.addressSearch(address, function(result, status) {
                debugger;
                // 정상적으로 검색이 완료됐으면
                if (status === kakao.maps.services.Status.OK) {
                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                    debugger;
                    // 지도 옵션 설정
                    var staticMapContainer = document.getElementById('staticMap');
                    var staticMapOption = {
                        center: coords,
                        level: 3,
                        marker: {
                            position: coords,
                            text: acmName
                        }
                    };

                    // 지도 생성
                    var staticMap = new kakao.maps.StaticMap(staticMapContainer, staticMapOption);
                    debugger;
                } else {
                    // 주소-좌표 변환 실패 시 에러 처리
                    console.error('주소를 찾을 수 없습니다:', address);
                    document.getElementById('staticMap').innerHTML = '지도를 불러올 수 없습니다.';
                }
            });
        });
    </sFcript>
</body>
</html>